/*!
 * Scrollify - v1.0.0
 *
 * Author: Michael Pazienza
 * Copyright 2012 Mass Relevance
 *
 * Scrollify allows for a custom scrollbar to work along with mousewheel and touch events.
 * 
 * USE: you will need a mask, content container, and scrollbar with handle
 * 
 * <div class="mask">
 *   <div class="content"></div>
 *   <div class="scrollbar"><div class="handle">&nbsp;</div></div>
 * </div>
 * 
 * CSS: you can use this boilerplate as a starter
 * 
 * .mask {height:100%;position:relative;overflow:hidden;}
 * .content {position:absolute;}
 * .scrollbar {height:100%;width:1em;top:0;right:0;background:#ccc;position:absolute;z-index:2;}
 * .scrollbar .handle {width:1em;height:6em;top:0;left:0;background:#fff;border-radius:15px;position:absolute;cursor:pointer;z-index:3;}
 * 
 * Your will then initialize the Scrollify function on the mask element $('.mask').Scrollify();
 */
(function(b,a){b.fn.Scrollify=function(f){var c={touch_enable:true,wheel_enable:true,bar_enable:true,auto_generate:false,class_bar:"scrollbar",class_handle:"handle",class_content:"content"},e=b(a);f=b.extend(c,f);function d(g){if(g.originalEvent){return g.originalEvent.changedTouches||g.originalEvent.touches}return g.touches}return this.each(function(){var q=b(this),t=q.find("."+f.class_bar),j=t.find("."+f.class_handle),l=q.find("."+f.class_content),o=0,r=false,h=0,n,g,p,v,s,m,u,i,k;n=function(){t=b("<div>").addClass(f.class_bar);j=b("<div>").addClass(f.class_handle).appendTo(t);q.wrapInner(b("<div>").addClass(f.class_content));l=q.find("."+f.class_content);q.append(t)};k=function(w){w.preventDefault();w.stopPropagation();e.unbind("mouseup",g);e.unbind("mousemove",v);q.unbind("touchend.touchScroll touchcancel.touchScroll",u);q.unbind("touchmove.touchScroll",i);if(f.bar_enable){j.bind("mousedown",p)}if(f.touch_enable){q.bind("touchstart.touchScroll",m)}};g=function(w){w.preventDefault();w.stopPropagation();e.unbind("mouseup",g);e.unbind("mousemove",v);j.bind("mousedown",p)};p=function(w){w.preventDefault();w.stopPropagation();o=w.pageY-j.offset().top;j.unbind("mousedown",p);e.bind("mouseup",g);e.bind("mousemove",v)};v=function(z){z.preventDefault();z.stopPropagation();var x=t.innerHeight()-j.height(),y=z.pageY-t.offset().top-o,w;if(y<0){y=0}else{if(y>x){y=x}}w=(l.outerHeight()-q.innerHeight())*(y/x);j.css("margin-top",y+"px");if(l.outerHeight()>q.innerHeight()){l.css("margin-top",-(w)+"px")}};s=function(A){A.preventDefault();A.stopPropagation();var z=A.originalEvent.wheelDelta||-A.originalEvent.detail*2,x=-Math.abs(l.outerHeight()-q.innerHeight()),w=z+parseInt(l.css("margin-top"),10),y;if(w<x){w=x}else{if(w>0){w=0}}y=(t.innerHeight()-j.height())*Math.abs(w/x);j.css("margin-top",y+"px");l.css("margin-top",w+"px")};m=function(x){x.preventDefault();x.stopPropagation();var w=d(x)[0];r=true;h=w.pageY;q.unbind("touchstart.touchScroll",m);q.bind("touchend.touchScroll touchcancel.touchScroll",u);q.bind("touchmove.touchScroll",i)};u=function(w){w.preventDefault();w.stopPropagation();r=false;q.unbind("touchend.touchScroll touchcancel.touchScroll",u);q.unbind("touchmove.touchScroll",i);q.bind("touchstart.touchScroll",m)};i=function(A){A.preventDefault();A.stopPropagation();if(r){var z=(d(A)[0].pageY-h)*0.8,x=-Math.abs(l.outerHeight()-q.innerHeight()),w=z+parseInt(l.css("margin-top"),10),y;if(w<x){w=x}else{if(w>0){w=0}}y=(t.innerHeight()-j.height())*Math.abs(w/x);j.css("margin-top",y+"px");l.css("margin-top",w+"px")}};if(f.bar_enable){if(!t.length&&!j.length&&f.auto_generate){n()}j.bind("mousedown",p)}if(f.wheel_enable){q.bind("mousewheel DOMMouseScroll",s)}if(f.touch_enable){q.bind("touchstart.touchScroll",m)}e.bind("mouseleave",k)})}}(jQuery,window));